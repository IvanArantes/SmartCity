var app=angular.module("SmartCityApp",[]);
app.controller("mapacontroller",function(a,e){a.kp="Sensor:Sensor1";a.ontology="SensoresArduino";a.token="26e75ce8b75f4323bfd2657677911e55";a.markers=[];a.markersBkp=[];a.sessionKey=null;a.connection;a.markersMap=[];a.marker=[];a.querySens="select * from SensoresArduino";$(function(){dwr.engine.setActiveReverseAjax(!1);dwr.engine.setTimeout(0);dwr.engine.setErrorHandler(function(a){alert(a)});connection=new k});var k=function(){a.sessionKey;a.getSessionKey=function(){return a.sessionKey}};a.connect=
function(b,c,d,f){sofia2.joinToken(d,c,function(b){null!=b&&null!=b.body.data&&1==b.body.ok?(a.sessionKey=b.sessionKey,"undefined"!==typeof f&&f(a.sessionKey)):alert("Error\n"+b.body.error)})};a.addInArray=function(b){for(var c=!0,d=0,f;d<a.markers.length&&1==c;)b.sensor==a.markers[d].sensor&&(c=!1,f=d),d++;c?a.markers.push(b):a.markers[f]=b};a.queryResultCall=function(b){if(null!=b)if(null!=b.body&&null!=b.body.data&&1==b.body.ok){var c;a.markers=[];for(var d=0;d<b.body.data.length;d++)c=JSON.stringify(b.body.data[d],
void 0,2),0==a.markers.length?a.markers.push(JSON.parse(c).SensoresArduino):a.addInArray(JSON.parse(c).SensoresArduino);a.deleteMarkers();a.setMarkers()}else a.resultbox=b.body.error;else a.resultbox="Sem resultado"};a.sendCustomMessage=function(b,c,d){null!=connection?(a.sessionKey=a.getSessionKey(),null!=a.sessionKey?sofia2.queryWithQueryType(c.replace(/[\n\r]+/g,"").replace(/\s{2,10}/g,""),b,"SQLLIKE",null,d):a.resultbox="por favor realiza um join"):a.resultbox="por favor realiza um join(connection)"};
a.conectar=function(){a.connect(a.ontology,a.kp,a.token,function(a){console.log(a)})};a.desconectar=function(){null!=connection&&connection.leave(function(b){a.resultbox="desconectado"})};a.action=function(){a.sendCustomMessage(a.ontology,a.querySens,a.queryResultCall)};a.clonaArray=function(){for(var b=0;b<a.markers.length;b++)a.markersBkp[b]=a.markers[b]};a.map;a.marker;a.mapOptions={zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,center:{lat:-16.68189,lng:-49.255539}};a.map=new google.maps.Map(document.getElementById("map"),
a.mapOptions);a.geocoder=new google.maps.Geocoder;a.geocodeAddress=function(b){a.address=b;a.geocoder.geocode({address:b},function(b,d){d===google.maps.GeocoderStatus.OK?(a.map.setCenter(b[0].geometry.location),new google.maps.Marker({map:a.map,animation:google.maps.Animation.DROP,position:a.results[0].geometry.location})):alert("N\u00e3o foram encontrados resultados: "+a.status)})};a.deleteMarkers=function(){a.clearMarkers();a.markersMap=[]};a.clearArrayMarkers=function(){a.markers=[]};a.clearMarkers=
function(){for(var b=0;b<a.markersMap.length;b++)a.markersMap[b].setMap(null)};a.setMarkers=function(){for(var b=new google.maps.InfoWindow,c=0;c<a.markers.length;c++){var d=a.markers[c].geometry.coordinates[0],f=a.markers[c].geometry.coordinates[1],e=new google.maps.LatLng(d,f);a.marker=new google.maps.Marker({position:e,map:a.map,title:a.markers[c].sensor,icon:"img/icosensor.png"});d="<p>Nome do Sensor: "+a.markers[c].sensor+"</p><p>Latitude: "+d+"</p><p>Longitude: "+f+"</p><p>Data da modifica\u00e7\u00e3o: "+
a.markers[c].data_disparo.$date.substring(0,10)+"</p>";google.maps.event.addListener(a.marker,"click",function(c,d){return function(){b.setContent(d);b.open(a.map,c)}}(a.marker,d));a.markersMap.push(a.marker)}};window.setTimeout(a.conectar(),500);window.setTimeout(a.action,1E3);a.valueInterval=10;var g=e(a.action,1E3*a.valueInterval),h=e(a.conectar,1E3*a.valueInterval);a.$watch("valueInterval",function(){e.cancel(g);e.cancel(h);console.log("valor"+a.valueInterval);h=e(a.conectar,1E3*a.valueInterval);
g=e(a.action,1E3*a.valueInterval)})});