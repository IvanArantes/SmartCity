<!--
Â© Indra Sistemas, S.A.
2013 - 2014  SPAIN

All rights reserved
-->
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>KP Javascript Consumidor</title>
        
        <link rel="stylesheet" type="text/css" href="styles/standard.css" />
        <script src="jquery.min.js" type="text/javascript">;</script>
		
        <script type="text/javascript"> var pathToDwrServlet = 'http://sofia2.com/sib/dwr';</script>
        <script type='text/javascript' src='http://sofia2.com/sib/dwr/engine.js'></script>
        <script type='text/javascript' src='http://sofia2.com/sib/dwr/util.js'></script>
        <script type='text/javascript' src='http://sofia2.com/sib/dwr/interface/GatewayDWR.js'></script>
        <script type='text/javascript' src="sofia2-api-js_v2.13.0.js">;</script>
		
		<script type='text/javascript' src="XXTEA.js">;</script>
		<script type='text/javascript' src="base64.js">;</script>
				
		<script type="text/javascript">

		//<![CDATA[ 
	
		var sessionKey;
			
		$(function(){
			 dwr.engine.setActiveReverseAjax(true);
			 dwr.engine.setErrorHandler(errorHandler);
			 dwr.engine.setTimeout(0);
		});

		function errorHandler(message, ex){   
			console.log( "ERROR:" + ex.message );
		}
     
		function conectarSIB(token, instance){
			sofia2.joinToken(token, instance, function(mensajeSSAP){
				if(mensajeSSAP != null && mensajeSSAP.body.data != null && mensajeSSAP.body.ok == true){
					sessionKey = mensajeSSAP.sessionKey;
					$("#infoConexion").text("Conectado al sib con sessionkey: "+mensajeSSAP.sessionKey).show();
				}else{
					$("#infoConexion").text("Error conectando del sib").show();
				}
			});
		}

		function desconectarSIB() {
			sofia2.leave(function(mensajeSSAP){
				if(mensajeSSAP != null && mensajeSSAP.body.data != null && mensajeSSAP.body.ok == true){
					$("#infoConexion").text("Desconectado del sib").show();
				}else{
					$("#infoConexion").text("Error desconectando del sib").show();
				}
			}, sessionKey);
		}   
		  
		function enviar(campo01, campo02, campo03){  
			var ontologyInstance='"TesteConexao":{ "Campo01": "'+campo01+'", "Campo02": 0, "Campo03": "'+campo03+'"}';
			sofia2.insert(ontologyInstance, 'TesteConexao', function(mensajeSSAP){
				if(mensajeSSAP != null && mensajeSSAP.body.data != null && mensajeSSAP.body.ok == true){
					$("#infoSensorTemperatura").text("Cliente Enviada").show();
				}else{
					$("#infoSensorTemperatura").text("Error Enviando cliente").show();
				}
			}, sessionKey);
		}
  
  		//]]>

		</script>   
	</head>
		
	<body>
		<img src="img/logo_sofia2.png" alt="KP javascript" height="10%" width="15%">   
		<table style="border:none;">
			<tr style="border:none;">
				<td style="border:none;">
					<b>Token:</b> <input type="text" id="token" size="36" style="margin:4px" value="557d7f380c7242948016390375f0e207"/>
					<b>Instancia:</b> <input type="text" id="instanceByToken" size="40" style="margin:4px" value="testeconctar:testeconctar1"/>
					<input type="button" value="Conectar SIB" style="margin:4px" onclick='conectarSIB($("#token").val(), $("#instanceByToken").val());'/>
					<input type="button" value="Desconectar SIB" style="margin:4px" onclick='desconectarSIB()'/>
					 <b id="infoConexion" style="color:blue;float:right;margin-top:10px;display:none;" />   
				</td>
			</tr>
		</table> 
	    <table style="border:none;">                
			<tr style="border:none;">
				<td style="border:none;">
					<b>Campo01:</b>           
					<input type="text" id="valor" size="36" value="3" style="margin:4px"/>
					<b>Campo01:</b> 
					<input type="text" id="valor2" size="36" value="0" style="margin:4px"/>
					<b>Campo03:</b> 
					<input type="text" id="valor3" size="36" value="3" style="margin:4px"/>
					<input type="button" value="Enviar" style="margin:4px" onclick='enviar($("#valor").val(), $("#valor2").val(), $("#valor3").val());'/>
					<b id="infoSensorTemperatura" style="color:blue;float:right;margin-top:10px;display:none;" />                
				</td>
			</tr>
	    </table>      
	</body>
</html>